import{d as le,C as ne,r as y,f as oe,R as ae,i as se,L as Y,n as re,S as Z,j as b,c as N,b as c,m as A,q as $,l as V,A as F,v as S,G as O,H as I,x as B,p as ie,a as de,o as _,I as ce,k as D,_ as ue}from"./index-68e97df2.js";import{v as pe}from"./vueData-fd2fb5cd.js";const P={color:[{title:"黑色",value:"black"},{title:"白色",value:"white"},{title:"红色",value:"red"},{title:"蓝色",value:"blue"},{title:"黄色",value:"yellow"},{title:"绿色",value:"green"},{title:"紫色",value:"purple"},{title:"橙色",value:"orange"},{title:"青色",value:"cyan"}],textType:[{title:"标题",value:"h"},{title:"副标题",value:"h2"},{title:"正文",value:"normal"},{title:"加粗",value:"bold"},{title:"加细",value:"light"}],textShape:[{title:"斜体",value:"italic"},{title:"下划线",value:"underline"}]};function ve(l,u){if(!l)return u;let p="",C=u.lastIndexOf("-"),r=u.slice(0,C);return l.split(" ").forEach(h=>{h.indexOf(r)==-1&&(p+=" "+h)}),p+=" "+u,p.trim()}const G=function(){let l=document.createElement("span");function u(p){l.innerHTML=p;let C=[...l.children[0].classList].sort((r,h)=>r<h?-1:1);for(let r=1;r<l.children.length;r++)C.toString()==[...l.children[r].classList].sort((h,m)=>h<m?-1:1).toString()?(l.children[r-1].innerText=l.children[r-1].innerText+l.children[r].innerText,l.removeChild(l.children[r]),r--):C=[...l.children[r].classList].sort((h,m)=>h<m?-1:1);return l.innerHTML}return u}();function L(l,u,p){!l||!u||u==document.getElementById("vn-container")||l.nextSibling!=u&&(l.nextSibling?(l.parentNode.removeChild(l.nextSibling),L(l,u,p)):(l.parentNode==document.getElementById("vn-container")&&L(p,u.parentNode,p),L(l.parentNode,u,p)))}const fe=l=>(ie("data-v-013560bd"),l=l(),de(),l),_e={class:"page_top"},he={class:"desc"},ge={class:"vue-node"},me={class:"carousel-img"},xe=fe(()=>c("span",null,"这是几张图片",-1)),Ne={key:1,class:"node-show"},Te=["contenteditable","innerHTML"],ye={class:"operate-color"},Ce={class:"tag-area"},Se={class:"operate-color"},ke={class:"tag-area"},we={class:"operate-textTpye"},be={class:"tag-area"},$e={class:"operate-textShape"},Ve={class:"tag-area"},Oe=le({__name:"Details",setup(l){const u=ne();function p(e){return location.origin+`/static/${e}`}const C=[p("sjbizhi2.jpg"),p("sjbizhi3.jpg"),p("sjbizhi4.jpg"),p("sjbizhi5.jpg")];console.log(C);const r=y(void 0),h=new BroadcastChannel("details");h.onmessage=e=>{r.value=e.data,location.hash="#/details/"+e.data};const m=oe(()=>pe.filter(e=>e.id==r.value)[0]||{}),J=y(),U=y(),H=y(),M=y(),ee=y(),n=y({startNode:null,endNode:null,startTextNode:null,endTextNode:null,value:void 0,startOff:0,endOff:0}),k=y(!0);function K(){k.value=!k.value}function te(){const e=getSelection();n.value.value=e==null?void 0:e.toString(),n.value.startNode=e==null?void 0:e.anchorNode.parentNode,n.value.endNode=e==null?void 0:e.extentNode.parentNode,n.value.startTextNode=e==null?void 0:e.anchorNode,n.value.endTextNode=e==null?void 0:e.extentNode,n.value.startOff=e==null?void 0:e.anchorOffset,n.value.endOff=e==null?void 0:e.extentOffset,console.log("startTextNode.nodeValue",e==null?void 0:e.anchorNode.nodeValue),console.log("endTextNode.nodeValue",e==null?void 0:e.extentNode.nodeValue)}function E(e){let g=n.value.value;if(!g)return;let R=document.getElementById("vn-container");const j=n.value.startTextNode==n.value.endTextNode;if(console.log("inOneSpan",j),j){let t=n.value.startNode,s=n.value.startTextNode,d=s.nodeValue,w=Math.min(n.value.startOff,n.value.endOff),v=Math.max(n.value.startOff,n.value.endOff),a=d.slice(0,w),f=d.slice(v,d.length);if(t.nodeName.toUpperCase()!="SPAN"){console.log("文本标签");let i=document.createElement("span");i.className=e,i.innerText=g;let x=document.createTextNode(a),T=document.createTextNode(f);t.insertBefore(x,s),t.insertBefore(i,s),t.insertBefore(T,s),t.removeChild(s);return}else{console.log("span标签");let i=ve(t.className,e);a&&f?(console.log(1),d=`<span${t.className?` class="${t.className}"`:""}>${a}</span><span class="${i}">${g}</span><span${t.className?` class="${t.className}"`:""}>${f}</span>`):a&&!f?(console.log(2),console.log("afterStr",f),d=`<span${t.className?` class="${t.className}"`:""}>${a}</span><span class="${i}">${g}</span>`):!a&&f?(console.log(3),d=`<span class="${i}">${g}</span><span${t.className?` class="${t.className}"`:""}>${f}</span>`):(console.log(4),d=`<span class="${i}">${g}</span>`),t.innerHTML=G(d),(!a||!f)&&(t.parentNode.innerHTML=G(t.parentNode.innerHTML))}}else{let t=n.value.startNode,s=n.value.endNode,d=n.value.startOff,w=n.value.endOff,v=n.value.startTextNode,a=n.value.endTextNode;console.log("startTextNode.nodeValue",v.nodeValue),console.log("endTextNode.nodeValue",a.nodeValue);let f=v.nodeValue.slice(0,d),i=v.nodeValue.slice(d,v.nodeValue.length),x=a.nodeValue.slice(0,w),T=a.nodeValue.slice(w,a.nodeValue.length),o=document.createElement("span");o.className=e,o.innerText=g,g.replace(/\(/g,"_").replace(/\)/g,"-").search(i.replace(/\(/g,"_").replace(/\)/g,"-"))==0?(console.log("从前往后"),g!==i+x&&L(v,a,v),n.value.startTextNode.nodeValue=f,n.value.endTextNode.nodeValue=T,s.nodeName.toUpperCase()!="SPAN"?(console.log("前1"),s.insertBefore(o,a),!T&&s.removeChild(a)):(console.log("前2"),s.parentNode.insertBefore(o,s),!T&&s.parentNode.removeChild(s)),t.nodeName.toUpperCase()!="SPAN"?(console.log("前3"),!f&&t.removeChild(v)):(console.log("前4"),!f&&t.parentNode.removeChild(t))):(console.log("从后往前"),g!==i+x&&L(a,v,a),n.value.startTextNode.nodeValue=i,n.value.endTextNode.nodeValue=x,t.nodeName.toUpperCase()!="SPAN"?(console.log("后1"),t.insertBefore(o,v),!i&&t.removeChild(v)):(console.log("后2"),t.parentNode.insertBefore(o,t),!i&&t.parentNode.removeChild(t)),s.nodeName.toUpperCase()!="SPAN"?(console.log("后3"),!x&&s.removeChild(a)):(console.log("后4"),!x&&s.parentNode.removeChild(s))),R.innerHTML=G(R.innerHTML)}}let W,Q,X;function q(){if(k.value){if(!M._value)return;W=parseInt(window.getComputedStyle(J._value).width,10),Q=parseInt(window.getComputedStyle(M._value).width,10),X=parseInt(window.getComputedStyle(M._value).right,10),H._value.style.width=(Q+X)*.88+"px",U._value.style.right=parseInt(H._value.style.width,10)+W*.03+45+"px"}else H._value.style.width=0,U._value.style.right=W*.03+40+"px"}return ae(()=>{k.value,q()},{flush:"post"}),se(()=>{Y("detailsIsOpen","true"),r.value||(r.value=u.params.id)}),re(()=>{Z(q)()}),window.onresize=Z(q),window.onbeforeunload=()=>{Y("detailsIsOpen","false"),h.close()},(e,g)=>{var v,a,f,i,x,T;const R=b("el-image"),j=b("el-carousel-item"),t=b("el-carousel"),s=b("el-icon"),d=b("el-tag"),w=b("el-button");return _(),N("div",{ref_key:"containerRef",ref:J,class:"container"},[c("div",_e,[c("h1",null,A((v=m.value)==null?void 0:v.title),1),c("div",he,A((a=m.value)==null?void 0:a.desc),1)]),c("div",ge,[c("div",me,[xe,$(t,{"indicator-position":"none"},{default:V(()=>[(_(),N(O,null,I(C,o=>$(j,{key:o},{default:V(()=>[$(R,{style:{width:"150px",height:"300px"},src:o,fit:"fill"},null,8,["src"])]),_:2},1024)),64))]),_:1})]),(f=m.value)!=null&&f.html?(_(),N("div",{key:0,ref_key:"editIcon",ref:U,class:"edit-show"},[$(s,{onClick:K},{default:V(()=>[$(B(ce))]),_:1})],512)):F("",!0),(i=m.value)!=null&&i.html?(_(),N("div",Ne,[c("div",{class:"node-text",ref_key:"vueNodeRef",ref:ee,contenteditable:k.value,innerHTML:(x=m.value)==null?void 0:x.html,onMouseup:te},null,40,Te)])):F("",!0),c("div",{ref_key:"operatePlaceRef",ref:H,class:"node-operate_place"},null,512),k.value&&((T=m.value)!=null&&T.html)?(_(),N("div",{key:2,ref_key:"operateRef",ref:M,class:"node-operate"},[c("div",ye,[S(" 字体颜色: "),c("span",Ce,[(_(!0),N(O,null,I(B(P).color,o=>(_(),D(d,{key:o.value,color:o.value,onClick:z=>E("vn-color-"+o.value)},null,8,["color","onClick"]))),128))])]),c("div",Se,[S(" 背景颜色: "),c("span",ke,[(_(!0),N(O,null,I(B(P).color,o=>(_(),D(d,{key:o.value,color:o.value,onClick:z=>E("vn-background-color-"+o.value)},null,8,["color","onClick"]))),128))])]),c("div",we,[S(" 字体类型: "),c("span",be,[(_(!0),N(O,null,I(B(P).textType,o=>(_(),D(d,{key:o.value,onClick:z=>E("vn-text-type-"+o.value)},{default:V(()=>[S(A(o.title),1)]),_:2},1032,["onClick"]))),128))])]),c("div",$e,[S(" 字体类型: "),c("span",Ve,[(_(!0),N(O,null,I(B(P).textShape,o=>(_(),D(d,{key:o.value,onClick:z=>E("vn-text-shape-"+o.value)},{default:V(()=>[S(A(o.title),1)]),_:2},1032,["onClick"]))),128))])]),$(w,{class:"edit-ok",type:"primary",size:"small",onClick:K},{default:V(()=>[S("完成编辑")]),_:1})],512)):F("",!0)])],512)}}});const Le=ue(Oe,[["__scopeId","data-v-013560bd"]]);export{Le as default};
