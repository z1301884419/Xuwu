import{d as Q,C as W,r as V,f as X,i as Y,L as P,n as Z,h as ee,j as b,c as N,a as f,m as A,q as k,l as $,A as R,v as C,G as w,H as B,x as L,p as te,b as le,o as _,I as ne,k as D,_ as oe}from"./index-a2eccc6b.js";import{v as ae}from"./vueData-60e0b439.js";const U={color:[{title:"黑色",value:"black"},{title:"白色",value:"white"},{title:"红色",value:"red"},{title:"蓝色",value:"blue"},{title:"黄色",value:"yellow"},{title:"绿色",value:"green"},{title:"紫色",value:"purple"},{title:"橙色",value:"orange"},{title:"青色",value:"cyan"}],textType:[{title:"标题",value:"h"},{title:"副标题",value:"h2"},{title:"正文",value:"normal"},{title:"加粗",value:"bold"},{title:"加细",value:"light"}],textShape:[{title:"斜体",value:"italic"},{title:"下划线",value:"underline"}]};function se(l,d){if(!l)return d;let u="",y=d.lastIndexOf("-"),r=d.slice(0,y);return l.split(" ").forEach(h=>{h.indexOf(r)==-1&&(u+=" "+h)}),u+=" "+d,u.trim()}const q=function(){let l=document.createElement("span");function d(u){l.innerHTML=u;let y=[...l.children[0].classList].sort((r,h)=>r<h?-1:1);for(let r=1;r<l.children.length;r++)y.toString()==[...l.children[r].classList].sort((h,g)=>h<g?-1:1).toString()?(l.children[r-1].innerText=l.children[r-1].innerText+l.children[r].innerText,l.removeChild(l.children[r]),r--):y=[...l.children[r].classList].sort((h,g)=>h<g?-1:1);return l.innerHTML}return d}();function I(l,d,u){!l||!d||d==document.getElementById("vn-container")||l.nextSibling!=d&&(l.nextSibling?(l.parentNode.removeChild(l.nextSibling),I(l,d,u)):(l.parentNode==document.getElementById("vn-container")&&I(u,d.parentNode,u),I(l.parentNode,d,u)))}const re=l=>(te("data-v-c56b470f"),l=l(),le(),l),ie={class:"container"},ce={class:"desc"},de={class:"carousel-img"},ue=re(()=>f("span",null,"这是几张图片",-1)),pe={key:0,class:"node-show"},ve=["contenteditable","innerHTML"],fe={key:1,class:"edit-show"},_e={key:2,class:"node-operate"},he={class:"operate-color"},me={class:"tag-area"},ge={class:"operate-color"},xe={class:"tag-area"},Ne={class:"operate-textTpye"},Te={class:"tag-area"},Ce={class:"operate-textShape"},ye={class:"tag-area"},Se=Q({__name:"Details",setup(l){const d=W();function u(e){return location.origin+location.pathname+`/static/${e}`}const y=[u("sjbizhi2.jpg"),u("sjbizhi3.jpg"),u("sjbizhi4.jpg"),u("sjbizhi5.jpg")],r=V(void 0),h=new BroadcastChannel("details");h.onmessage=e=>{r.value=e.data,location.hash="#/details/"+e.data};const g=X(()=>ae.filter(e=>e.id==r.value)[0]||{}),n=V({startNode:null,endNode:null,startTextNode:null,endTextNode:null,value:void 0,startOff:0,endOff:0}),O=V(!0);function F(){O.value=!O.value}function J(){const e=getSelection();n.value.value=e==null?void 0:e.toString(),n.value.startNode=e==null?void 0:e.anchorNode.parentNode,n.value.endNode=e==null?void 0:e.extentNode.parentNode,n.value.startTextNode=e==null?void 0:e.anchorNode,n.value.endTextNode=e==null?void 0:e.extentNode,n.value.startOff=e==null?void 0:e.anchorOffset,n.value.endOff=e==null?void 0:e.extentOffset}function H(e){let m=n.value.value;if(!m)return;let M=document.getElementById("vn-container");const j=n.value.startTextNode==n.value.endTextNode;if(console.log("inOneSpan",j),j){let t=n.value.startNode,s=n.value.startTextNode,c=s.nodeValue,S=Math.min(n.value.startOff,n.value.endOff),p=Math.max(n.value.startOff,n.value.endOff),a=c.slice(0,S),v=c.slice(p,c.length);if(t.nodeName.toUpperCase()!="SPAN"){console.log("文本标签");let i=document.createElement("span");i.className=e,i.innerText=m;let x=document.createTextNode(a),T=document.createTextNode(v);t.insertBefore(x,s),t.insertBefore(i,s),t.insertBefore(T,s),t.removeChild(s);return}else{console.log("span标签");let i=se(t.className,e);a&&v?(console.log(1),c=`<span${t.className?` class="${t.className}"`:""}>${a}</span><span class="${i}">${m}</span><span${t.className?` class="${t.className}"`:""}>${v}</span>`):a&&!v?(console.log(2),console.log("afterStr",v),c=`<span${t.className?` class="${t.className}"`:""}>${a}</span><span class="${i}">${m}</span>`):!a&&v?(console.log(3),c=`<span class="${i}">${m}</span><span${t.className?` class="${t.className}"`:""}>${v}</span>`):(console.log(4),c=`<span class="${i}">${m}</span>`),t.innerHTML=q(c),(!a||!v)&&(t.parentNode.innerHTML=q(t.parentNode.innerHTML))}}else{let t=n.value.startNode,s=n.value.endNode,c=n.value.startOff,S=n.value.endOff,p=n.value.startTextNode,a=n.value.endTextNode;console.log("startTextNode.nodeValue",p.nodeValue),console.log("endTextNode.nodeValue",a.nodeValue);let v=p.nodeValue.slice(0,c),i=p.nodeValue.slice(c,p.nodeValue.length),x=a.nodeValue.slice(0,S),T=a.nodeValue.slice(S,a.nodeValue.length),o=document.createElement("span");o.className=e,o.innerText=m,m.replace(/\(/g,"_").replace(/\)/g,"-").search(i.replace(/\(/g,"_").replace(/\)/g,"-"))==0?(console.log("从前往后"),m!==i+x&&I(p,a,p),n.value.startTextNode.nodeValue=v,n.value.endTextNode.nodeValue=T,s.nodeName.toUpperCase()!="SPAN"?(console.log("前1"),s.insertBefore(o,a),!T&&s.removeChild(a)):(console.log("前2"),s.parentNode.insertBefore(o,s),!T&&s.parentNode.removeChild(s)),t.nodeName.toUpperCase()!="SPAN"?(console.log("前3"),!v&&t.removeChild(p)):(console.log("前4"),!v&&t.parentNode.removeChild(t))):(console.log("从后往前"),m!==i+x&&I(a,p,a),n.value.startTextNode.nodeValue=i,n.value.endTextNode.nodeValue=x,t.nodeName.toUpperCase()!="SPAN"?(console.log("后1"),t.insertBefore(o,p),!i&&t.removeChild(p)):(console.log("后2"),t.parentNode.insertBefore(o,t),!i&&t.parentNode.removeChild(t)),s.nodeName.toUpperCase()!="SPAN"?(console.log("后3"),!x&&s.removeChild(a)):(console.log("后4"),!x&&s.parentNode.removeChild(s))),M.innerHTML=q(M.innerHTML)}}const G=V(),z=V();function K(){let e=parseInt(getComputedStyle(G.value).height,10);z.value.style.marginTop=e+"px",z.value.style.height=`calc(100vh - ${e+110}px)`}return Y(()=>{P("detailsIsOpen","true"),r.value||(r.value=d.params.id)}),Z(()=>{K()}),ee(()=>{P("detailsIsOpen","false"),h.close()}),window.onbeforeunload=()=>{P("detailsIsOpen","false"),h.close()},(e,m)=>{var p,a,v,i,x,T;const M=b("el-image"),j=b("el-carousel-item"),t=b("el-carousel"),s=b("el-icon"),c=b("el-tag"),S=b("el-button");return _(),N("div",ie,[f("div",{class:"page_top",ref_key:"topRef",ref:G},[f("h1",null,A((p=g.value)==null?void 0:p.title),1),f("div",ce,A((a=g.value)==null?void 0:a.desc),1)],512),f("div",{class:"vue-node",ref_key:"contentRef",ref:z},[f("div",de,[ue,k(t,{"indicator-position":"none"},{default:$(()=>[(_(),N(w,null,B(y,o=>k(j,{key:o},{default:$(()=>[k(M,{style:{width:"150px",height:"300px"},src:o,fit:"fill"},null,8,["src"])]),_:2},1024)),64))]),_:1})]),(v=g.value)!=null&&v.html?(_(),N("div",pe,[f("div",{class:"node-text",contenteditable:O.value,innerHTML:(i=g.value)==null?void 0:i.html,onMouseup:J},null,40,ve)])):R("",!0),(x=g.value)!=null&&x.html&&!O.value?(_(),N("div",fe,[k(s,{onClick:F},{default:$(()=>[k(L(ne))]),_:1})])):R("",!0),O.value&&((T=g.value)!=null&&T.html)?(_(),N("div",_e,[f("div",he,[C(" 字体颜色: "),f("span",me,[(_(!0),N(w,null,B(L(U).color,o=>(_(),D(c,{key:o.value,color:o.value,onClick:E=>H("vn-color-"+o.value)},null,8,["color","onClick"]))),128))])]),f("div",ge,[C(" 背景颜色: "),f("span",xe,[(_(!0),N(w,null,B(L(U).color,o=>(_(),D(c,{key:o.value,color:o.value,onClick:E=>H("vn-background-color-"+o.value)},null,8,["color","onClick"]))),128))])]),f("div",Ne,[C(" 字体类型: "),f("span",Te,[(_(!0),N(w,null,B(L(U).textType,o=>(_(),D(c,{key:o.value,onClick:E=>H("vn-text-type-"+o.value)},{default:$(()=>[C(A(o.title),1)]),_:2},1032,["onClick"]))),128))])]),f("div",Ce,[C(" 字体类型: "),f("span",ye,[(_(!0),N(w,null,B(L(U).textShape,o=>(_(),D(c,{key:o.value,onClick:E=>H("vn-text-shape-"+o.value)},{default:$(()=>[C(A(o.title),1)]),_:2},1032,["onClick"]))),128))])]),k(S,{class:"edit-ok",type:"primary",size:"small",onClick:F},{default:$(()=>[C("完成编辑")]),_:1})])):R("",!0)],512)])}}});const $e=oe(Se,[["__scopeId","data-v-c56b470f"]]);export{$e as default};
