import{d as te,B as le,r as y,f as ne,Q as oe,i as ae,K as X,n as se,R as Y,j as b,c as N,b as c,m as A,q as V,l as $,A as q,v as C,F as O,G as B,x as I,p as re,a as ie,o as _,H as de,k as D,_ as ce}from"./index-a083caa2.js";import{v as ue}from"./vueData-fd2fb5cd.js";const P={color:[{title:"黑色",value:"black"},{title:"白色",value:"white"},{title:"红色",value:"red"},{title:"蓝色",value:"blue"},{title:"黄色",value:"yellow"},{title:"绿色",value:"green"},{title:"紫色",value:"purple"},{title:"橙色",value:"orange"},{title:"青色",value:"cyan"}],textType:[{title:"标题",value:"h"},{title:"副标题",value:"h2"},{title:"正文",value:"normal"},{title:"加粗",value:"bold"},{title:"加细",value:"light"}],textShape:[{title:"斜体",value:"italic"},{title:"下划线",value:"underline"}]};function pe(l,u){if(!l)return u;let h="",x=u.lastIndexOf("-"),i=u.slice(0,x);return l.split(" ").forEach(p=>{p.indexOf(i)==-1&&(h+=" "+p)}),h+=" "+u,h.trim()}const G=function(){let l=document.createElement("span");function u(h){l.innerHTML=h;let x=[...l.children[0].classList].sort((i,p)=>i<p?-1:1);for(let i=1;i<l.children.length;i++)x.toString()==[...l.children[i].classList].sort((p,k)=>p<k?-1:1).toString()?(l.children[i-1].innerText=l.children[i-1].innerText+l.children[i].innerText,l.removeChild(l.children[i]),i--):x=[...l.children[i].classList].sort((p,k)=>p<k?-1:1);return l.innerHTML}return u}();function L(l,u,h){!l||!u||u==document.getElementById("vn-container")||l.nextSibling!=u&&(l.nextSibling?(l.parentNode.removeChild(l.nextSibling),L(l,u,h)):(l.parentNode==document.getElementById("vn-container")&&L(h,u.parentNode,h),L(l.parentNode,u,h)))}const ve=l=>(re("data-v-6ed8fccb"),l=l(),ie(),l),fe={class:"page_top"},_e={class:"desc"},he={class:"vue-node"},me={class:"carousel-img"},ge=ve(()=>c("span",null,"这是几张图片",-1)),xe={key:1,class:"node-show"},Ne=["contenteditable","innerHTML"],Te={class:"operate-color"},ye={class:"tag-area"},Ce={class:"operate-color"},ke={class:"tag-area"},Se={class:"operate-textTpye"},we={class:"tag-area"},be={class:"operate-textShape"},Ve={class:"tag-area"},$e=te({__name:"Details",setup(l){const u=le(),h=["../src/assets/sjbizhi2.jpg","../src/assets/sjbizhi3.jpg","../src/assets/sjbizhi4.jpg","../src/assets/sjbizhi5.jpg"],x=y(void 0),i=new BroadcastChannel("details");i.onmessage=e=>{x.value=e.data,location.hash="#/details/"+e.data};const p=ne(()=>ue.filter(e=>e.id==x.value)[0]||{}),k=y(),U=y(),H=y(),M=y(),Z=y(),n=y({startNode:null,endNode:null,startTextNode:null,endTextNode:null,value:void 0,startOff:0,endOff:0}),S=y(!0);function K(){S.value=!S.value}function ee(){const e=getSelection();n.value.value=e==null?void 0:e.toString(),n.value.startNode=e==null?void 0:e.anchorNode.parentNode,n.value.endNode=e==null?void 0:e.extentNode.parentNode,n.value.startTextNode=e==null?void 0:e.anchorNode,n.value.endTextNode=e==null?void 0:e.extentNode,n.value.startOff=e==null?void 0:e.anchorOffset,n.value.endOff=e==null?void 0:e.extentOffset,console.log("startTextNode.nodeValue",e==null?void 0:e.anchorNode.nodeValue),console.log("endTextNode.nodeValue",e==null?void 0:e.extentNode.nodeValue)}function E(e){let m=n.value.value;if(!m)return;let R=document.getElementById("vn-container");const j=n.value.startTextNode==n.value.endTextNode;if(console.log("inOneSpan",j),j){let t=n.value.startNode,s=n.value.startTextNode,d=s.nodeValue,w=Math.min(n.value.startOff,n.value.endOff),v=Math.max(n.value.startOff,n.value.endOff),a=d.slice(0,w),f=d.slice(v,d.length);if(t.nodeName.toUpperCase()!="SPAN"){console.log("文本标签");let r=document.createElement("span");r.className=e,r.innerText=m;let g=document.createTextNode(a),T=document.createTextNode(f);t.insertBefore(g,s),t.insertBefore(r,s),t.insertBefore(T,s),t.removeChild(s);return}else{console.log("span标签");let r=pe(t.className,e);a&&f?(console.log(1),d=`<span${t.className?` class="${t.className}"`:""}>${a}</span><span class="${r}">${m}</span><span${t.className?` class="${t.className}"`:""}>${f}</span>`):a&&!f?(console.log(2),console.log("afterStr",f),d=`<span${t.className?` class="${t.className}"`:""}>${a}</span><span class="${r}">${m}</span>`):!a&&f?(console.log(3),d=`<span class="${r}">${m}</span><span${t.className?` class="${t.className}"`:""}>${f}</span>`):(console.log(4),d=`<span class="${r}">${m}</span>`),t.innerHTML=G(d),(!a||!f)&&(t.parentNode.innerHTML=G(t.parentNode.innerHTML))}}else{let t=n.value.startNode,s=n.value.endNode,d=n.value.startOff,w=n.value.endOff,v=n.value.startTextNode,a=n.value.endTextNode;console.log("startTextNode.nodeValue",v.nodeValue),console.log("endTextNode.nodeValue",a.nodeValue);let f=v.nodeValue.slice(0,d),r=v.nodeValue.slice(d,v.nodeValue.length),g=a.nodeValue.slice(0,w),T=a.nodeValue.slice(w,a.nodeValue.length),o=document.createElement("span");o.className=e,o.innerText=m,m.replace(/\(/g,"_").replace(/\)/g,"-").search(r.replace(/\(/g,"_").replace(/\)/g,"-"))==0?(console.log("从前往后"),m!==r+g&&L(v,a,v),n.value.startTextNode.nodeValue=f,n.value.endTextNode.nodeValue=T,s.nodeName.toUpperCase()!="SPAN"?(console.log("前1"),s.insertBefore(o,a),!T&&s.removeChild(a)):(console.log("前2"),s.parentNode.insertBefore(o,s),!T&&s.parentNode.removeChild(s)),t.nodeName.toUpperCase()!="SPAN"?(console.log("前3"),!f&&t.removeChild(v)):(console.log("前4"),!f&&t.parentNode.removeChild(t))):(console.log("从后往前"),m!==r+g&&L(a,v,a),n.value.startTextNode.nodeValue=r,n.value.endTextNode.nodeValue=g,t.nodeName.toUpperCase()!="SPAN"?(console.log("后1"),t.insertBefore(o,v),!r&&t.removeChild(v)):(console.log("后2"),t.parentNode.insertBefore(o,t),!r&&t.parentNode.removeChild(t)),s.nodeName.toUpperCase()!="SPAN"?(console.log("后3"),!g&&s.removeChild(a)):(console.log("后4"),!g&&s.parentNode.removeChild(s))),R.innerHTML=G(R.innerHTML)}}let F,Q,J;function W(){if(S.value){if(!M._value)return;F=parseInt(window.getComputedStyle(k._value).width,10),Q=parseInt(window.getComputedStyle(M._value).width,10),J=parseInt(window.getComputedStyle(M._value).right,10),H._value.style.width=(Q+J)*.88+"px",U._value.style.right=parseInt(H._value.style.width,10)+F*.03+45+"px"}else H._value.style.width=0,U._value.style.right=F*.03+40+"px"}return oe(()=>{S.value,W()},{flush:"post"}),ae(()=>{X("detailsIsOpen","true"),x.value||(x.value=u.params.id)}),se(()=>{Y(W)()}),window.onresize=Y(W),window.onbeforeunload=()=>{X("detailsIsOpen","false"),i.close()},(e,m)=>{var v,a,f,r,g,T;const R=b("el-image"),j=b("el-carousel-item"),t=b("el-carousel"),s=b("el-icon"),d=b("el-tag"),w=b("el-button");return _(),N("div",{ref_key:"containerRef",ref:k,class:"container"},[c("div",fe,[c("h1",null,A((v=p.value)==null?void 0:v.title),1),c("div",_e,A((a=p.value)==null?void 0:a.desc),1)]),c("div",he,[c("div",me,[ge,V(t,{"indicator-position":"none"},{default:$(()=>[(_(),N(O,null,B(h,o=>V(j,{key:o},{default:$(()=>[V(R,{style:{width:"150px",height:"300px"},src:o,fit:"fill"},null,8,["src"])]),_:2},1024)),64))]),_:1})]),(f=p.value)!=null&&f.html?(_(),N("div",{key:0,ref_key:"editIcon",ref:U,class:"edit-show"},[V(s,{onClick:K},{default:$(()=>[V(I(de))]),_:1})],512)):q("",!0),(r=p.value)!=null&&r.html?(_(),N("div",xe,[c("div",{class:"node-text",ref_key:"vueNodeRef",ref:Z,contenteditable:S.value,innerHTML:(g=p.value)==null?void 0:g.html,onMouseup:ee},null,40,Ne)])):q("",!0),c("div",{ref_key:"operatePlaceRef",ref:H,class:"node-operate_place"},null,512),S.value&&((T=p.value)!=null&&T.html)?(_(),N("div",{key:2,ref_key:"operateRef",ref:M,class:"node-operate"},[c("div",Te,[C(" 字体颜色: "),c("span",ye,[(_(!0),N(O,null,B(I(P).color,o=>(_(),D(d,{key:o.value,color:o.value,onClick:z=>E("vn-color-"+o.value)},null,8,["color","onClick"]))),128))])]),c("div",Ce,[C(" 背景颜色: "),c("span",ke,[(_(!0),N(O,null,B(I(P).color,o=>(_(),D(d,{key:o.value,color:o.value,onClick:z=>E("vn-background-color-"+o.value)},null,8,["color","onClick"]))),128))])]),c("div",Se,[C(" 字体类型: "),c("span",we,[(_(!0),N(O,null,B(I(P).textType,o=>(_(),D(d,{key:o.value,onClick:z=>E("vn-text-type-"+o.value)},{default:$(()=>[C(A(o.title),1)]),_:2},1032,["onClick"]))),128))])]),c("div",be,[C(" 字体类型: "),c("span",Ve,[(_(!0),N(O,null,B(I(P).textShape,o=>(_(),D(d,{key:o.value,onClick:z=>E("vn-text-shape-"+o.value)},{default:$(()=>[C(A(o.title),1)]),_:2},1032,["onClick"]))),128))])]),V(w,{class:"edit-ok",type:"primary",size:"small",onClick:K},{default:$(()=>[C("完成编辑")]),_:1})],512)):q("",!0)])],512)}}});const Ie=ce($e,[["__scopeId","data-v-6ed8fccb"]]);export{Ie as default};
